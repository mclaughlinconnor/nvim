id: no-non-terminal-res-inside-condition
message: Potentially suspicious non-terminal response inside condition
severity: hint
language: typescript
rule:
  all:
    - any:
      - pattern: res.$A($$$B);
      - pattern: res.$A($$$B)
    - kind: expression_statement # not call_expression so that the return_statement isn't one level above
    - not:
        any:
          - inside:
              kind: return_statement
              stopBy: end
          - precedes:
              kind: return_statement
              stopBy: neighbor
    - inside:
        kind: if_statement
        stopBy: end
fix: return res.$A($$$B)
constraints:
  A:
    any:
      - regex: badRequest
      - regex: conflict
      - regex: forbidden
      - regex: invalidGocardlessToken
      - regex: methodNotAllowed
      - regex: notFound
      - regex: ok
      - regex: serverError
      - regex: serviceUnavailable
      - regex: unauthorized
